import{a as _e}from"./chunk-BHEACCP3.js";import{Aa as re,Ba as ae,C as S,Ca as le,E,Ea as se,F as z,G as D,Ga as ue,H as L,I as j,Ia as ce,J as F,Ja as me,L as B,M as R,O as $,Q as U,aa as K,b as g,ba as Z,c as d,d as V,e as u,f as k,fa as G,g as N,ga as H,h as f,i as _,j as o,k as r,l as I,m as A,n as M,na as q,o as v,oa as J,p as x,pa as Q,q as l,qa as W,r as O,ra as X,s as c,sa as Y,t as C,ta as ee,u as P,ua as te,v as T,wa as ne,xa as ie,za as oe}from"./chunk-PCYDMJPV.js";import"./chunk-W6H37XDB.js";import"./chunk-7KGURMOZ.js";import"./chunk-YK4DTNHI.js";import"./chunk-YK3APVNZ.js";import"./chunk-366LSZGT.js";import"./chunk-JVTPOORY.js";import"./chunk-CLDSZD2A.js";import"./chunk-4WFVMWDK.js";import"./chunk-M2X7KQLB.js";import"./chunk-DVVH2KKN.js";import"./chunk-NV3QH4JK.js";import"./chunk-4YRHGV2P.js";import"./chunk-OZYWYLNK.js";import"./chunk-42C7ZIID.js";import{a as h,b as y}from"./chunk-JHI3MBHO.js";function pe(s,p){if(s&1){let i=v();o(0,"ion-button",27),x("click",function(){g(i);let t=l(2);return d(t.openProjekt())}),c(1),r()}if(s&2){let i,e=l(2);u(),P(" Zum Projekt ",(i=e.projekt())==null?null:i.nr," ")}}function ge(s,p){if(s&1){let i=v();o(0,"ion-datetime",28),x("ionChange",function(t){g(i);let n=l(2);return d(n.updateField("datum",n.asString(t.detail.value)))}),r()}if(s&2){let i,e=l(2);_("value",(i=e.form())==null?null:i.datum)}}function de(s,p){if(s&1&&(o(0,"ion-select-option",29),c(1),r()),s&2){let i=p.$implicit;_("value",i),u(),C(i)}}function xe(s,p){if(s&1&&(o(0,"ion-select-option",29),c(1),S(2,"currency"),r()),s&2){let i=p.$implicit;_("value",i.id),u(),T(" ",i.titel," \xB7 ",E(2,3,i.einzelpreis,"EUR","symbol","1.0-0")," ")}}function be(s,p){if(s&1&&(o(0,"div",45),c(1),r()),s&2){let i=l(3).$implicit;u(),C(i.beschreibung)}}function fe(s,p){if(s&1&&(o(0,"div",41)(1,"div",42),c(2),r(),o(3,"div",43),c(4),S(5,"currency"),r(),f(6,be,2,1,"div",44),r()),s&2){let i=l(2).$implicit;u(2),C(i.titel),u(2),T("",i.einheit," \xB7 ",E(5,4,i.einzelpreis,"EUR","symbol","1.2-2")),u(2),_("ngIf",i.beschreibung)}}function he(s,p){if(s&1){let i=v();A(0),o(1,"ion-item",35)(2,"ion-label",13),c(3,"Aus Katalog \xFCbernehmen"),r(),o(4,"ion-select",36),x("ionChange",function(t){g(i);let n=l().index,a=l(2);return d(a.selectFromCatalog(n,a.asCatalogId(t.detail.value)))}),o(5,"ion-select-option",37),c(6,"Keine Auswahl"),r(),f(7,xe,3,8,"ion-select-option",18),r()(),f(8,fe,7,9,"div",38),o(9,"ion-item",35)(10,"ion-label",13),c(11,"Menge"),r(),o(12,"ion-input",39),x("ionInput",function(t){g(i);let n=l().index,a=l(2);return d(a.updateLeistung(n,{menge:a.asNumber(t.detail.value)}))}),r()(),o(13,"ion-button",40),x("click",function(){g(i);let t=l().index,n=l(2);return d(n.useManualEntry(t))}),c(14," Eigene Leistung erfassen "),r(),M()}if(s&2){let i=l().$implicit,e=l(2);u(4),_("value",i.katalogId??""),u(3),_("ngForOf",e.katalog()),u(),_("ngIf",i.katalogId),u(4),_("value",i.menge)}}function ve(s,p){if(s&1&&(o(0,"ion-select-option",29),c(1),r()),s&2){let i=p.$implicit;_("value",i),u(),C(i)}}function ye(s,p){if(s&1){let i=v();o(0,"ion-grid",46)(1,"ion-row")(2,"ion-col",47)(3,"ion-item",35)(4,"ion-label",13),c(5,"Art"),r(),o(6,"ion-select",17),x("ionChange",function(t){g(i);let n=l().index,a=l(2);return d(a.updateLeistung(n,{typ:a.asLeistungsart(t.detail.value)}))}),f(7,ve,2,2,"ion-select-option",18),r()()(),o(8,"ion-col",48)(9,"ion-item",35)(10,"ion-label",13),c(11,"Titel"),r(),o(12,"ion-input",49),x("ionInput",function(t){g(i);let n=l().index,a=l(2);return d(a.updateLeistung(n,{titel:a.asString(t.detail.value)}))}),r()()()(),o(13,"ion-row")(14,"ion-col",50)(15,"ion-item",35)(16,"ion-label",13),c(17,"Beschreibung"),r(),o(18,"ion-textarea",51),x("ionInput",function(t){g(i);let n=l().index,a=l(2);return d(a.updateLeistung(n,{beschreibung:a.asString(t.detail.value)}))}),r()()()(),o(19,"ion-row")(20,"ion-col",47)(21,"ion-item",35)(22,"ion-label",13),c(23,"Menge"),r(),o(24,"ion-input",39),x("ionInput",function(t){g(i);let n=l().index,a=l(2);return d(a.updateLeistung(n,{menge:a.asNumber(t.detail.value)}))}),r()()(),o(25,"ion-col",47)(26,"ion-item",35)(27,"ion-label",13),c(28,"Einheit"),r(),o(29,"ion-input",52),x("ionInput",function(t){g(i);let n=l().index,a=l(2);return d(a.updateLeistung(n,{einheit:a.asString(t.detail.value)}))}),r()()(),o(30,"ion-col",47)(31,"ion-item",35)(32,"ion-label",13),c(33,"Einzelpreis (netto)"),r(),o(34,"ion-input",39),x("ionInput",function(t){g(i);let n=l().index,a=l(2);return d(a.updateLeistung(n,{einzelpreis:a.asNumber(t.detail.value)}))}),r()()()()(),o(35,"ion-button",40),x("click",function(){g(i);let t=l().index,n=l(2);return d(n.useCatalogEntry(t))}),c(36," Aus Katalog w\xE4hlen "),r()}if(s&2){let i=l().$implicit,e=l(2);u(6),_("value",i.typ),u(),_("ngForOf",e.leistungstypen),u(5),_("value",i.titel),u(6),_("value",i.beschreibung),u(6),_("value",i.menge),u(5),_("value",i.einheit),u(5),_("value",i.einzelpreis)}}function Ce(s,p){if(s&1){let i=v();o(0,"div",30)(1,"div",31)(2,"div",32),c(3),r(),o(4,"ion-button",33),x("click",function(){let t=g(i).index,n=l(2);return d(n.removeLeistung(t))}),c(5," Entfernen "),r()(),f(6,he,15,4,"ng-container",8)(7,ye,37,7,"ng-template",null,1,z),o(9,"div",34)(10,"span"),c(11,"Positionssumme"),r(),o(12,"span"),c(13),S(14,"currency"),r()()()}if(s&2){let i,e=p.$implicit,t=p.index,n=O(8),a=l(2);u(3),P("Position ",t+1),u(),_("disabled",(((i=a.form())==null||i.leistungen==null?null:i.leistungen.length)||0)<=1),u(2),_("ngIf",e.modus==="catalog")("ngIfElse",n),u(7),C(E(14,5,a.calcPositionSum(e),"EUR","symbol","1.2-2"))}}function Ie(s,p){if(s&1){let i=v();A(0),o(1,"div",10),c(2),r(),f(3,pe,2,1,"ion-button",11),o(4,"ion-list",12)(5,"ion-item")(6,"ion-label",13),c(7,"Datum"),r(),I(8,"ion-datetime-button",14),o(9,"ion-modal",15),f(10,ge,1,1,"ng-template"),r()(),o(11,"ion-item")(12,"ion-label",13),c(13,"Nummer"),r(),o(14,"ion-input",16),x("ionInput",function(t){g(i);let n=l();return d(n.updateField("nr",n.asString(t.detail.value)))}),r()(),o(15,"ion-item")(16,"ion-label",13),c(17,"Status"),r(),o(18,"ion-select",17),x("ionChange",function(t){g(i);let n=l();return d(n.updateField("status",n.asStatus(t.detail.value)))}),f(19,de,2,2,"ion-select-option",18),r()(),o(20,"ion-item")(21,"ion-label",13),c(22,"Titel"),r(),o(23,"ion-input",19),x("ionInput",function(t){g(i);let n=l();return d(n.updateField("name",n.asString(t.detail.value)))}),r()(),o(24,"ion-item")(25,"ion-label",13),c(26,"Erstellt von"),r(),o(27,"ion-input",20),x("ionInput",function(t){g(i);let n=l();return d(n.updateField("erstelltVon",n.asString(t.detail.value)))}),r()()(),o(28,"div",21)(29,"div",22),c(30,"Leistungen"),r(),o(31,"ion-button",23),x("click",function(){g(i);let t=l();return d(t.addLeistung())}),c(32," Position hinzuf\xFCgen "),r()(),o(33,"div",24),f(34,Ce,15,10,"div",25),r(),o(35,"ion-item",26)(36,"ion-label"),c(37,"Gesamtsumme (netto)"),r(),o(38,"ion-text",4),c(39),S(40,"currency"),r()(),M()}if(s&2){let i,e,t,n,a,m,b=l();u(2),P(" ",((i=b.form())==null?null:i.name)||"Angebot"," "),u(),_("ngIf",b.projekt()),u(6),_("keepContentsMounted",!0),u(5),_("value",(e=b.form())==null?null:e.nr),u(4),_("value",(t=b.form())==null?null:t.status),u(),_("ngForOf",b.statusOptions),u(4),_("value",(n=b.form())==null?null:n.name),u(4),_("value",(a=b.form())==null?null:a.erstelltVon),u(7),_("ngForOf",(m=b.form())==null?null:m.leistungen),u(5),C(E(40,10,b.leistungssumme(),"EUR","symbol","1.2-2"))}}function Se(s,p){if(s&1){let i=v();o(0,"div",53)(1,"p"),c(2,"Dieses Angebot konnte nicht gefunden werden."),r(),o(3,"ion-button",54),x("click",function(){g(i);let t=l();return d(t.goBack())}),c(4,"Zur \xDCbersicht"),r()()}}var Me=(()=>{let p=class p{constructor(e,t,n){this.route=e,this.router=t,this.dummy=n,this.projekt=D(()=>{let m=this.projektNr;return m?this.dummy.projektesig().find(b=>b.nr===m)??null:null}),this.angebot=D(()=>{let m=this.projekt();return m?(m.angebote??[])[this.angebotIndex]??null:null}),this.form=V(null),this.toastOpen=V(!1),this.statusOptions=["Entwurf","Versendet","Akzeptiert","Abgelehnt"],this.leistungstypen=["Dienstleistung","Ersatzteil"],this.katalog=this.dummy.leistungskatalogsig,this.leistungssumme=D(()=>{let m=this.form();return m?m.leistungen.reduce((b,w)=>b+(Number(w.menge)||0)*(Number(w.einzelpreis)||0),0):0}),this.dummy.createProjects(),this.projektNr=this.route.snapshot.paramMap.get("nr")??"";let a=this.route.snapshot.paramMap.get("angebotIndex");this.angebotIndex=a?Number(a):0,Number.isNaN(this.angebotIndex)&&(this.angebotIndex=0),L(()=>{let m=this.angebot();if(!m){this.form.set(null);return}this.form.set(this.createFormState(m))})}createFormState(e){let t=(e.leistungen??[]).map(n=>({typ:n.typ??"Dienstleistung",titel:n.titel??"",beschreibung:n.beschreibung??"",menge:Number(n.menge)||0,einheit:n.einheit??"Std",einzelpreis:Number(n.einzelpreis)||0,katalogId:n.katalogId??null,modus:n.katalogId?"catalog":"manual"}));return{datum:e.datum?new Date(e.datum).toISOString():new Date().toISOString(),nr:e.nr??"-",status:e.status??"Entwurf",name:e.name??"",erstelltVon:e.erstelltVon??"",leistungen:t.length?t:[this.createEmptyLeistung()]}}createEmptyLeistung(){return{typ:"Dienstleistung",titel:"",beschreibung:"",menge:1,einheit:"Std",einzelpreis:0,katalogId:null,modus:"catalog"}}updateField(e,t){this.form.update(n=>n&&y(h({},n),{[e]:t}))}updateLeistung(e,t){this.form.update(n=>{if(!n)return n;let a=n.leistungen.map((m,b)=>{if(b!==e)return m;let w=typeof t=="function"?t(m):t;return h(h({},m),w)});return y(h({},n),{leistungen:a})})}addLeistung(){this.form.update(e=>e&&y(h({},e),{leistungen:[...e.leistungen,this.createEmptyLeistung()]}))}selectFromCatalog(e,t){this.updateLeistung(e,n=>{if(!t)return{katalogId:null,titel:"",beschreibung:"",menge:1,einheit:"Std",einzelpreis:0,modus:"catalog",typ:n.typ??this.leistungstypen[0]};let a=this.dummy.findLeistungById(t);return a?{katalogId:a.id,typ:a.typ,titel:a.titel,beschreibung:a.beschreibung??"",menge:a.menge??1,einheit:a.einheit,einzelpreis:a.einzelpreis,modus:"catalog"}:{katalogId:null,modus:"catalog"}})}useManualEntry(e){this.updateLeistung(e,t=>({modus:"manual",katalogId:null,typ:t.typ??this.leistungstypen[0],titel:"",beschreibung:"",menge:1,einheit:"Std",einzelpreis:0}))}useCatalogEntry(e){this.updateLeistung(e,t=>({modus:"catalog",katalogId:null,typ:t.typ??this.leistungstypen[0],titel:"",beschreibung:"",menge:1,einheit:"Std",einzelpreis:0}))}removeLeistung(e){this.form.update(t=>{if(!t)return t;let n=t.leistungen.filter((a,m)=>m!==e);return y(h({},t),{leistungen:n.length?n:[this.createEmptyLeistung()]})})}asString(e){return Array.isArray(e)?e[0]??"":e??""}asStatus(e){let t=this.asString(e);return this.statusOptions.includes(t)?t:this.statusOptions[0]}asLeistungsart(e){let t=this.asString(e);return this.leistungstypen.includes(t)?t:this.leistungstypen[0]}asCatalogId(e){let t=this.asString(e);return t||null}asNumber(e){Array.isArray(e)&&(e=e[0]);let t=typeof e=="number"?e:Number(e??0);return Number.isFinite(t)?t:0}calcPositionSum(e){let t=Number(e.menge)||0,n=Number(e.einzelpreis)||0;return t*n}openProjekt(){this.projektNr&&this.router.navigate(["/projekte",this.projektNr])}goBack(){this.router.navigate(["/angebote"])}save(){let e=this.form(),t=this.angebot();if(!e||!t||!this.projektNr)return;let n=e.leistungen.map(m=>y(h({},m.modus==="catalog"&&m.katalogId?{katalogId:m.katalogId}:{}),{typ:m.typ,titel:m.titel?.trim()||"Leistung",beschreibung:m.beschreibung?.trim()||void 0,menge:Number(m.menge)||0,einheit:m.einheit?.trim()||"Einheit",einzelpreis:Number(m.einzelpreis)||0})),a=y(h({},t),{datum:e.datum?new Date(e.datum):new Date,nr:e.nr?.trim()||"-",status:e.status?.trim()||"Entwurf",name:e.name?.trim()||"Angebot",erstelltVon:e.erstelltVon?.trim()||void 0,leistungen:n,betragNetto:this.leistungssumme()});this.dummy.updateAngebot(this.projektNr,this.angebotIndex,a),this.toastOpen.set(!0)}closeToast(){this.toastOpen.set(!1)}};p.\u0275fac=function(t){return new(t||p)(k($),k(U),k(_e))},p.\u0275cmp=N({type:p,selectors:[["app-angebot-detail"]],decls:19,vars:4,consts:[["missing",""],["angebotManualForm",""],["slot","start"],["defaultHref","/angebote"],["slot","end"],["color","primary",3,"click","disabled"],[1,"ion-padding"],["size","8"],[4,"ngIf","ngIfElse"],["message","\xC4nderungen gespeichert","duration","1500","position","bottom",3,"didDismiss","isOpen"],[1,"page-heading"],["fill","clear","size","small","color","primary",3,"click",4,"ngIf"],["lines","full",1,"base-form"],["position","stacked"],["datetime","angebot-date"],[3,"keepContentsMounted"],["placeholder","A-1000",3,"ionInput","value"],["interface","popover",3,"ionChange","value"],[3,"value",4,"ngFor","ngForOf"],["placeholder","z. B. Zusatzarbeiten",3,"ionInput","value"],["placeholder","CM",3,"ionInput","value"],[1,"positions-header"],[1,"title"],["size","small","fill","outline","color","primary",3,"click"],[1,"position-list"],["class","position",4,"ngFor","ngForOf"],["lines","full",1,"sum-item"],["fill","clear","size","small","color","primary",3,"click"],["id","angebot-date","presentation","date",3,"ionChange","value"],[3,"value"],[1,"position"],[1,"position-head"],[1,"label"],["size","small","fill","clear","color","medium",3,"click","disabled"],[1,"position-sum"],["lines","full"],["interface","popover","placeholder","Leistung ausw\xE4hlen",3,"ionChange","value"],["value",""],["class","catalog-preview",4,"ngIf"],["type","number",3,"ionInput","value"],["size","small","fill","clear","color","primary",3,"click"],[1,"catalog-preview"],[1,"catalog-title"],[1,"catalog-meta"],["class","catalog-desc",4,"ngIf"],[1,"catalog-desc"],["fixed",""],["size","12","size-md","4"],["size","12","size-md","8"],["placeholder","Bezeichnung",3,"ionInput","value"],["size","12"],["auto-grow","true","placeholder","optional",3,"ionInput","value"],["placeholder","Std",3,"ionInput","value"],[1,"missing"],[3,"click"]],template:function(t,n){if(t&1){let a=v();o(0,"ion-header")(1,"ion-toolbar")(2,"ion-buttons",2),I(3,"ion-back-button",3),r(),o(4,"ion-title"),c(5,"Angebot"),r(),o(6,"ion-buttons",4)(7,"ion-button",5),x("click",function(){return g(a),d(n.save())}),c(8,"Speichern"),r()()()(),o(9,"ion-content",6)(10,"ion-grid")(11,"ion-row"),I(12,"ion-col"),o(13,"ion-col",7),f(14,Ie,41,15,"ng-container",8)(15,Se,5,0,"ng-template",null,0,z),o(17,"ion-toast",9),x("didDismiss",function(){return g(a),d(n.closeToast())}),r()(),I(18,"ion-col"),r()()()}if(t&2){let a=O(16);u(7),_("disabled",!n.form()),u(7),_("ngIf",n.form())("ngIfElse",a),u(3),_("isOpen",n.toastOpen())}},dependencies:[X,le,re,H,K,J,te,Y,ee,ue,ce,ie,G,oe,Q,Z,se,W,ne,q,ae,me,F,j,R,B],styles:["[_nghost-%COMP%]   ion-toolbar[_ngcontent-%COMP%]{--border-width: 0 0 1px 0;--border-color: var(--ion-color-step-150)}[_nghost-%COMP%]   ion-content[_ngcontent-%COMP%]{display:block}.page-heading[_ngcontent-%COMP%]{font-size:1.6rem;font-weight:600;margin-bottom:12px}.base-form[_ngcontent-%COMP%]{margin-top:12px;border-radius:14px;overflow:hidden;border:1px solid var(--ion-color-step-150)}.positions-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-top:24px;margin-bottom:12px}.positions-header[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%]{font-weight:600;font-size:1.1rem}.position-list[_ngcontent-%COMP%]{display:grid;gap:16px}.position[_ngcontent-%COMP%]{border:1px solid var(--ion-color-step-150);border-radius:14px;padding:16px;background:var(--ion-item-background, #fff)}.position-head[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between;margin-bottom:12px}.position-head[_ngcontent-%COMP%]   .label[_ngcontent-%COMP%]{font-weight:600}.position[_ngcontent-%COMP%]   ion-button[size=small][_ngcontent-%COMP%]{align-self:flex-start}.catalog-preview[_ngcontent-%COMP%]{background:var(--ion-color-step-50);border-radius:12px;padding:12px;display:flex;flex-direction:column;gap:6px;margin-bottom:8px}.catalog-title[_ngcontent-%COMP%]{font-weight:600}.catalog-meta[_ngcontent-%COMP%]{color:var(--ion-color-medium);font-size:.9rem}.catalog-desc[_ngcontent-%COMP%]{color:var(--ion-color-medium);font-size:.95rem;line-height:1.3}.position-sum[_ngcontent-%COMP%]{display:flex;justify-content:space-between;font-weight:600;margin-top:12px;padding-top:8px;border-top:1px solid var(--ion-color-step-150)}.sum-item[_ngcontent-%COMP%]{margin-top:20px;border-radius:12px;--background: var(--ion-color-step-50)}.missing[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center;gap:12px;padding:48px 0;text-align:center;color:var(--ion-color-medium)}"]});let s=p;return s})();export{Me as AngebotDetailPage};
